{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .urgent-task { border-left: 5px solid #dc3545; }
        .completed-task { opacity: 0.7; background-color: #f8f9fa; }
        .completed-task .task-title { text-decoration: line-through; }
        .task-card { transition: all 0.3s ease; }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        .nav-tabs .nav-link.active { font-weight: bold; }
        .priority-badge { font-size: 0.75rem; }
    </style>
    <link rel="stylesheet" href="{% static 'main/css/style.css' %}">
</head>
<body class="bg-light">
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h1 class="h4 mb-0">My Todo List</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTaskModal">
                            <i class="bi bi-plus-lg"></i> Add Task
                        </button>
                    </div>
                </div>

                <div class="card-body">
                    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
                        <li class="nav-item">
                            <button class="nav-link active" id="active-tab" data-bs-toggle="tab" data-bs-target="#active" type="button">
                                <i class="bi bi-list-check"></i> Active Tasks
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button">
                                <i class="bi bi-check-circle"></i> Completed
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content" id="myTabContent">
                        <!-- Active Tasks -->
                        <div class="tab-pane fade show active" id="active">
                            <form method="get" class="mb-4">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="search" placeholder="Search tasks..." value="{{ search_query }}">
                                    <button class="btn btn-outline-secondary" type="submit">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                            </form>

                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <small class="text-muted">Total tasks: {{ task_number }}</small>
                            </div>

                            <div class="task-list">
                                {% for task in tasks %}
                                    <div class="card task-card mb-3 {% if task.is_important %}urgent-task{% endif %}">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <h5 class="task-title mb-1">{{ task.title }}</h5>
                                                    <p class="text-muted small mb-2">Added: {{ task.created_at.ctime }}</p>
                                                    <span class="badge {% if task.is_important %}bg-danger{% else %}bg-secondary{% endif %}">
                                                        {% if task.is_important %}Urgent{% else %}Normal{% endif %}
                                                    </span>
                                                </div>
                                                <div class="btn-group">
                                                    <!-- Complete -->
                                                    <button class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#completeTaskModal{{ task.id }}">
                                                        <i class="bi bi-check-lg"></i>
                                                    </button>
                                                    <!-- Edit -->
                                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editTaskModal{{ task.id }}">
                                                        <i class="bi bi-pencil"></i>
                                                    </button>
                                                    <!-- Delete -->
                                                    <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteTaskModal{{ task.id }}">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Complete Modal -->
                                    <div class="modal fade" id="completeTaskModal{{ task.id }}" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <form action="{% url 'complete' task.id %}" method="post" class="modal-content">
                                                {% csrf_token %}
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Complete Task</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    Complete the task "{{ task.title }}"?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="submit" class="btn btn-success">Yes</button>
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                    <!-- Edit Modal -->
                                    <div class="modal fade" id="editTaskModal{{ task.id }}" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <form action="{% url 'edit' task.id %}" method="post" class="modal-content">
                                                {% csrf_token %}
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Edit Task</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="mb-3">
                                                        <label class="form-label">Title</label>
                                                        <input type="text" class="form-control" name="title" value="{{ task.title }}" required>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label">Description</label>
                                                        <textarea class="form-control" name="description">{{ task.description }}</textarea>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label">Priority</label><br>
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input" type="radio" name="is_important" value="False" id="normal{{ task.id }}" {% if not task.is_important %}checked{% endif %}>
                                                            <label class="form-check-label" for="normal{{ task.id }}">Normal</label>
                                                        </div>
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input" type="radio" name="is_important" value="True" id="urgent{{ task.id }}" {% if task.is_important %}checked{% endif %}>
                                                            <label class="form-check-label" for="urgent{{ task.id }}">Urgent</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="submit" class="btn btn-primary">Save</button>
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                    <!-- Delete Modal -->
                                    <div class="modal fade" id="deleteTaskModal{{ task.id }}" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <form action="{% url 'delete' task.id %}" method="post" class="modal-content">
                                                {% csrf_token %}
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Delete Task</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                </div>
                                                <div class="modal-body">
                                                    Delete the task "{{ task.title }}"?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="submit" class="btn btn-danger">Delete</button>
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Completed Tasks -->
                        <div class="tab-pane fade" id="completed">
                            <div class="task-list">
                                {% for task in completed_tasks %}
                                    <div class="card task-card mb-3 completed-task">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <h5 class="task-title mb-1">{{ task.title }}</h5>
                                                    <span class="badge bg-success priority-badge">Completed</span>
                                                </div>
                                                <div class="btn-group">
                                                    <form action="{% url 'undo' task.id %}" method="post">
                                                        {% csrf_token %}
                                                        <button class="btn btn-sm btn-outline-secondary" type="submit">
                                                            <i class="bi bi-arrow-counterclockwise"></i>
                                                        </button>
                                                    </form>
                                                    <form action="{% url 'delete' task.id %}" method="post">
                                                        {% csrf_token %}
                                                        <button class="btn btn-sm btn-outline-danger" type="submit">
                                                            <i class="bi bi-trash"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Task Modal -->
        <div class="modal fade" id="addTaskModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <form action="{% url 'add' %}" method="post" class="modal-content">
                    {% csrf_token %}
                    <div class="modal-header">
                        <h5 class="modal-title">Add New Task</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="taskTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="taskTitle" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label for="taskDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="taskDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Priority</label><br>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="is_important" value="False" id="priorityNormal" checked>
                                <label class="form-check-label" for="priorityNormal">Normal</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="is_important" value="True" id="priorityUrgent">
                                <label class="form-check-label" for="priorityUrgent">Urgent</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <p style="border-radius: 8px; text-align: center; font-size: 12px; color: #fff; margin-top: 16px; position: fixed; left: 8px; bottom: 8px; z-index: 10; background: rgba(0, 0, 0, 0.8); padding: 4px 8px;">
        Made with <img src="https://enzostvs-deepsite.hf.space/logo.svg" alt="DeepSite Logo" style="width: 16px; height: 16px; vertical-align: middle; margin-right:3px; filter: brightness(0) invert(1);">
        <a href="https://enzostvs-deepsite.hf.space" style="color: #fff; text-decoration: underline;" target="_blank">DeepSite</a> - 🧬
        <a href="https://enzostvs-deepsite.hf.space?remix=retriver8/todolist" style="color: #fff; text-decoration: underline;" target="_blank">Remix</a>
    </p>
</div>

<!-- Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
